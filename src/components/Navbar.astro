---
const links = [
  { id: 'about', es: 'Sobre mí', en: 'About' },
  { id: 'stack', es: 'Stack', en: 'Tech Stack' },
  { id: 'timeline', es: 'Trayectoria', en: 'Timeline' }
];
---

<nav data-navbar class="relative z-50 pointer-events-auto">
  <div
    class="mx-auto max-w-6xl px-6
          backdrop-blur
          bg-white/70
          dark:bg-zinc-950
          md:dark:bg-zinc-950/5
          border-b border-zinc-200 dark:border-white/5
          text-zinc-900 dark:text-zinc-100">
    <div class="flex h-14 items-center">

      <!-- LOGO -->
      <a href="#top" class="flex items-center gap-2">
        <img src="/icons/logo-jm-light.svg" class="h-8 block dark:hidden" alt="JM logo" />
        <img src="/icons/logo-jm-dark.svg"  class="h-8 hidden dark:block" alt="JM logo" />

        <span
          class="hidden sm:block text-lg font-medium leading-none"
          style="font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;"
        >
          Javier Martín
        </span>
      </a>

      <!-- LINKS DESKTOP -->
      <div class="ml-auto hidden md:flex items-center gap-6 text-sm font-medium">
        {links.map(link => (
          <a
            href={`#${link.id}`}
            class="hover:text-cyan-600 dark:hover:text-cyan-400 transition-colors"
          >
            {link.es}
          </a>
        ))}
      </div>

      <!-- HAMBURGER -->
      <div class="ml-auto flex items-center gap-3 md:ml-4">
        <slot />

        <button
          data-menu-btn
          type="button"
          class="md:hidden p-2
                 text-zinc-700 dark:text-zinc-200
                 hover:text-cyan-600 dark:hover:text-cyan-400
                 transition-colors"
          aria-label="Open menu"
          aria-expanded="false"
        >
          ☰
        </button>
      </div>
    </div>
  </div>

  <!-- MOBILE MENU -->
  <div
    data-mobile-menu
    class="md:hidden absolute top-full right-0 z-50
          w-[min(90vw,20rem)]
          pointer-events-auto
          border border-zinc-200 dark:border-white/5
          rounded-b-xl
          bg-white dark:bg-zinc-950
          text-zinc-900 dark:text-zinc-100
           
          opacity-0 -translate-y-2
          pointer-events-none
          transition-all duration-200 ease-out"
    >
    <div
      class="mx-auto max-w-6xl px-6 py-4
             flex flex-col gap-4 text-sm font-medium items-end"
    >
      {links.map(link => (
        <a
          href={`#${link.id}`}
          class="hover:text-cyan-600 dark:hover:text-cyan-400 transition-colors"
          data-mobile-link
        >
          {link.es}
        </a>
      ))}
    </div>
  </div>
</nav>

<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('[data-navbar]').forEach((nav) => {
      const btn  = nav.querySelector('[data-menu-btn]');
      const menu = nav.querySelector('[data-mobile-menu]');
      if (!btn || !menu) return;

      const openMenu = () => {
        menu.classList.remove(
          'opacity-0',
          '-translate-y-2',
          'pointer-events-none'
        );
        btn.setAttribute('aria-expanded', 'true');
      };

      const closeMenu = () => {
        menu.classList.add(
          'opacity-0',
          '-translate-y-2',
          'pointer-events-none'
        );
        btn.setAttribute('aria-expanded', 'false');
      };

      const isOpen = () =>
        !menu.classList.contains('opacity-0');

      // Toggle al pulsar el hamburger
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        isOpen() ? closeMenu() : openMenu();
      });

      // Cerrar al pulsar un link
      nav.querySelectorAll('[data-mobile-link]').forEach((link) => {
        link.addEventListener('click', closeMenu);
      });

      // Cerrar al hacer scroll
      window.addEventListener(
        'scroll',
        () => isOpen() && closeMenu(),
        { passive: true }
      );

      // Cerrar al pulsar fuera
      document.addEventListener('click', closeMenu);
    });
  });
</script>
